name: Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version tag (e.g. v0.5.0)'
        required: true
        default: 'v0.5.0'

env:
  CARGO_TERM_COLOR: always
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:

    riscv-imac-release:
        name: RISC-V IMAC Release (ESP32-C6 Projects)
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
            uses: actions/checkout@v4

            - name: Setup Rust for RISC-V IMAC
            uses: actions-rs/toolchain@v1
            with:
                toolchain: stable
                target: riscv32imac-unknown-none-elf

            - name: Build ESP32-C6 Project and collect assets
            run: |
                cd esp32-c6-waveshare-1_47 && cargo build --release && cd ..
                mkdir -p release_riscv
                cp esp32-c6-waveshare-1_47/target/riscv32imac-unknown-none-elf/release/esp32-conways-game-of-life-rs release_riscv/

            - name: Create GitHub Release for RISC-V
            uses: softprops/action-gh-release@v1
            with:
                tag_name: ${{ github.event.inputs.version }}
                name: "ESP32-C6 Release"
            env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Upload RISC-V Assets
            uses: softprops/action-gh-release@v1
            with:
                tag_name: ${{ github.event.inputs.version }}
                files: release_riscv/*
